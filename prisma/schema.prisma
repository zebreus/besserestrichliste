// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Transaction {
  id          Int          @id @default(autoincrement())
  // Short description of the transaction. Empty string if there is no description. No longer than XXX characters.
  title       String
  // Freetext describing the type of this transaction. Should be mostly enum-like values. like "charge", "sale", "transfer" or something like that
  type        String
  // When the transaction was processed
  processedAt DateTime     @default(now())
  // The amount of cents transferred from 'from' to 'to'. Always positive.
  amount      Int
  // The user that money is leaving from
  from        User?        @relation(name: "FromTransactions", fields: [fromId], references: [id])
  fromId      Int?
  // The user that money is going to
  to          User?        @relation(name: "ToTransactions", fields: [toId], references: [id])
  toId        Int?
  // The transaction that this transaction reverses (if this is a reversal transaction)
  reverses    Transaction? @relation(name: "TransactionReversal", fields: [reversesId], references: [id])
  reversesId  Int?         @unique
  // The transaction that reverses this transaction (if this transaction was undone)
  reversedBy  Transaction? @relation(name: "TransactionReversal")
}

model User {
  id         Int           @id @default(autoincrement())
  // Name of the user for display purposes
  name       String
  // Whether this user is internal. Internal users will be hidden from the overview
  internal   Boolean       @default(false)
  // The balance of the user in cents. Should get automatically updated when transactions are processed
  balance    Int           @default(0)
  createdAt  DateTime      @default(now())
  // The date when the user was last active
  lastActive DateTime      @default(now())
  // The transactions where this user is sending money
  fromIn     Transaction[] @relation(name: "FromTransactions")
  // The transactions where this user is receiving money
  toIn       Transaction[] @relation(name: "ToTransactions")
}
